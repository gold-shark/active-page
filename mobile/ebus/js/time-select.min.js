(function($, undefined) {
	var _html = '<div class="time-select"id="time-select"><div class="time-content"><div class="time-header"><h5>选择时间</h5></div><div class="time-body"><div class="time-items" id="time-hour"><div class="item">';
	for (var i = 0; i < 24; i++) {
		if (i < 10) {
			_html += '<p>0' + i + '</p>';
		} else {
			_html += '<p>' + i + '</p>';
		}
	}
	_html += '</div></div><div class="time-symbol"><p class="current">:</p></div><div class="time-items" id="time-minute"><div class="item">';
	for (var i = 0; i < 60; i++) {
		if (i < 10) {
			_html += '<p>0' + i + '</p>';
		} else {
			_html += '<p>' + i + '</p>';
		}
	}
	_html += '</div></div></div><div class="time-footer"><a class="cancel" id="time-cancel" href="javascript:void(0);">取消</a><a class="ok" id="time-ok" href="javascript:void(0);">确定</a></div></div></div>';

	$.fn.moveEvent = function(heg, leg, init) {
		var n = 0;
		var b = false;
		var startPot = {
			x: 0,
			y: 0
		};
		var endPot = {
			x: 0,
			y: 0
		};
		$(this).on('touchstart', function(e) {
			$.extend(startPot, {
				x: e.originalEvent.touches[0].pageX,
				y: e.originalEvent.touches[0].pageY
			});
		});
		$(this).on('touchmove', function(e) {
			e.originalEvent.preventDefault();
			b = true;
			$.extend(endPot, {
				x: e.originalEvent.touches[0].pageX,
				y: e.originalEvent.touches[0].pageY
			});
			$(this).find('.item').prefix({
				'transform': 'translateY(' + ((n + init) * heg + (endPot.y - startPot.y)) + 'px)'
			});
		});
		$(this).on('touchend', function(e) {
			if (b) {
				b = false;
				n += Math.round((endPot.y - startPot.y) / heg);
				if (n < -leg + 1) {
					n = -leg + 1;
				} else if (n > 0) {
					n = 0
				}
				$(this).find('.item').prefix({
					'transform': 'translateY(' + ((n + init) * heg) + 'px)',
				});
				$(this).find('p').eq(-n).addClass('current').siblings().removeClass('current');
			}
		});
	}

	$.fn.prefix = function(jsonObject) {
		$.each(jsonObject, function(i, v) {
			var str = '{\"-webkit-' + i + '\":\"' + v + '\",\"-moz-' + i + '\":\"' + v + '\",\"-ms-' + i + '\":\"' + v + '\",\"-o-' + i + '\":\"' + v + '\"}';
			$.extend(jsonObject, $.parseJSON(str));
		});
		$(this).css(jsonObject);
	}

	$.fn.tap = function(fun) {
		if (typeof fun === 'function') {
			var datetime = {
				start: 0,
				end: 0
			};
			this.on("touchstart.tap", function() {
				datetime.start = new Date().getTime();
			});
			this.on("touchend.tap", function() {
				datetime.end = new Date().getTime();
				if (datetime.end - datetime.start < 300) {
					fun();
				}
			});
		} else {
			throw new Error('arguments is not function');
		}
	}

	$.timeSelect = function(ok, cancel) {
		if (!$('#time-select').length) {
			$('body').append(_html);
		} else {
			$('#time-select').show();
			$('#time-hour,#time-minute').find('p').removeClass('current');
		}
		var heg = $('.time-items p').height();
		var init = 2;
		$('#time-hour,#time-minute').find('p:first').addClass('current');
		$('#time-hour,#time-minute').find('.item').prefix({
			'transform': 'translateY(' + init * heg + 'px)'
		});
		$('#time-hour').moveEvent(heg, 24, init);
		$('#time-minute').moveEvent(heg, 60, init);

		$('#time-ok').tap(function() {
			if (typeof ok === 'function') {
				ok();
			}
			$('#time-select').hide();
		});

		$('#time-cancel').tap(function() {
			if (typeof cancel === 'function') {
				cancel();
			}
			$('#time-select').hide();
		});

	}
}(jQuery));